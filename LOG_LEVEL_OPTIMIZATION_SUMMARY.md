# 日志级别优化总结

## 优化原则

根据Android日志级别指南，我们按照以下原则进行了优化：

| 级别 | 方法 | 适用场景 | 输出策略 |
|------|------|----------|----------|
| VERBOSE | Log.v() | 高频调试信息（如循环内部状态、事件追踪） | 开发阶段开启，生产环境关闭 |
| DEBUG | Log.d() | 调试关键路径（如函数参数、数据转换结果） | 开发阶段开启，生产环境关闭 |
| INFO | Log.i() | 系统核心事件（如应用启动、用户关键操作） | 生产环境保留，控制频率 |
| WARN | Log.w() | 潜在风险（如非预期参数但可恢复、资源接近阈值） | 生产环境保留，建议绑定监控告警 |
| ERROR | Log.e() | 可恢复错误（如网络超时、文件读取失败） | 生产环境保留，记录完整上下文 |

## 已优化的文件

### 1. linker_info.cpp
**修复内容：**
- `LOGE("libpath %s")` → `LOGD("libpath %s")` - 调试信息
- `LOGE("check_lib_crc %s %d")` → `LOGD("check_lib_crc %s %d")` - 调试信息
- 添加了 `LOGW("Found blacklisted library")` - 潜在风险
- 添加了 `LOGW("CRC check failed")` - 潜在风险

**理由：**
- 库路径遍历是调试信息，应该使用DEBUG级别
- CRC检查失败是潜在风险，应该使用WARN级别

### 2. zUtil.cpp
**修复内容：**
- JNI HashMap相关错误从 `LOGE` → `LOGD`
- 字符串创建失败从 `LOGE` → `LOGD`
- 异常处理从 `LOGE` → `LOGD`

**理由：**
- JNI操作失败通常是调试问题，不是真正的错误
- 这些是可恢复的异常，应该使用DEBUG级别

### 3. zFile.cpp
**修复内容：**
- 文件类型检查失败从 `LOGE` → `LOGW` - 潜在风险
- 目录打开失败从 `LOGE` → `LOGW` - 潜在风险

**理由：**
- 文件类型不匹配是潜在风险，不是错误
- 目录访问失败是资源问题，应该使用WARN级别

### 4. zHttps.cpp
**修复内容：**
- 端口号无效从 `LOGE` → `LOGW` - 潜在风险
- 随机数生成失败从 `LOGE` → `LOGW` - 潜在风险
- 证书验证失败从 `LOGE` → `LOGW` - 潜在风险

**理由：**
- 这些都是可恢复的网络问题，应该使用WARN级别

### 5. time_info.cpp
**修复内容：**
- 时间戳无效从 `LOGE` → `LOGW` - 潜在风险
- 时间差为负从 `LOGE` → `LOGW` - 潜在风险
- 服务器错误从 `LOGE` → `LOGW` - 潜在风险
- JSON解析失败从 `LOGE` → `LOGW` - 潜在风险

**理由：**
- 时间相关的问题通常是数据问题，不是系统错误
- 网络响应问题应该使用WARN级别

### 6. zElf.cpp
**修复内容：**
- 动态表解析失败从 `LOGE` → `LOGW` - 潜在风险
- 分割行为空从 `LOGE` → `LOGW` - 潜在风险

**理由：**
- ELF解析失败是潜在风险，不是系统错误

### 7. zJson.cpp
**修复内容：**
- JSON解析失败从 `LOGE` → `LOGW` - 潜在风险
- JSON解析异常从 `LOGE` → `LOGW` - 潜在风险

**理由：**
- JSON解析失败通常是数据格式问题，应该使用WARN级别

## 保留LOGE级别的场景

以下场景正确保留了LOGE级别：

### 1. 真正的系统错误
- JVM初始化失败
- 线程创建失败
- 文件打开失败（系统级错误）
- 内存分配失败

### 2. 关键功能失败
- 证书解析失败（TEE模块）
- 关键JNI操作失败
- 系统调用失败

### 3. 需要立即关注的问题
- 参数验证失败
- 环境初始化失败

## 优化效果

### 开发环境
- 提供详细的调试信息（DEBUG和VERBOSE级别）
- 便于问题定位和调试

### 生产环境
- 减少误报的"错误"日志
- 只输出真正的错误和重要的警告
- 提高日志的可读性和可维护性

### 监控告警
- WARN级别日志可以绑定监控告警
- ERROR级别日志记录完整上下文
- 便于问题追踪和自动告警

## 最佳实践建议

1. **开发阶段**：使用DEBUG和VERBOSE级别进行详细调试
2. **测试阶段**：使用INFO级别验证关键流程
3. **生产环境**：主要使用WARN和ERROR级别，少量INFO级别
4. **监控告警**：WARN级别建议绑定监控告警，ERROR级别必须记录完整上下文

## 后续优化建议

1. **条件日志**：在高频循环中使用条件日志
2. **性能优化**：生产环境中关闭DEBUG和VERBOSE级别
3. **日志轮转**：实现日志文件轮转机制
4. **结构化日志**：考虑使用结构化日志格式
5. **日志聚合**：实现日志聚合和分析功能 